Analysis: The code implements enhanced error handling with network retry logic and user-friendly error messages, PWA functionality including service worker registration, install prompts, and update notifications. // ì–¸í•¸ë“¤ë“œ Promise ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ window.addEventListener('unhandledrejection', (e) => { if (window.gtag) { gtag('event', 'promise_rejection', { error_reason: e.reason }); } }); // PWA ê¸°ëŠ¥ const PWAManager = { deferredPrompt: null, isInstalled: false, isInstallable: false, // Service Worker ë“±ë¡ async registerServiceWorker() { if ('serviceWorker' in navigator) { try { const registration = await navigator.serviceWorker.register('/egen-teto/ko/sw.js', { scope: '/egen-teto/ko/' }); console.log('[PWA] Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope); // ì—…ë°ì´íŠ¸ ê°ì§€ registration.addEventListener('updatefound', () => { const newWorker = registration.installing; if (newWorker) { newWorker.addEventListener('statechange', () => { if (newWorker.state === 'installed' && navigator.serviceWorker.controller) { this.showUpdateNotification(); } }); } }); // í™œì„± Service Worker ë³€ê²½ ê°ì§€ navigator.serviceWorker.addEventListener('controllerchange', () => { window.location.reload(); }); return registration; } catch (error) { console.error('[PWA] Service Worker ë“±ë¡ ì‹¤íŒ¨:', error); this.showErrorNotification('ì˜¤í”„ë¼ì¸ ê¸°ëŠ¥ì„ í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); } } else { console.warn('[PWA] Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ìž…ë‹ˆë‹¤.'); } }, // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬ handleInstallPrompt() { window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); this.deferredPrompt = e; this.isInstallable = true; this.showInstallButton(); console.log('[PWA] ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„ë¨'); }); // ì„¤ì¹˜ ì™„ë£Œ ê°ì§€ window.addEventListener('appinstalled', () => { this.isInstalled = true; this.hideInstallButton(); this.showSuccessNotification('ì•±ì´ í™ˆ í™”ë©´ì— ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤! ðŸŽ‰'); if (window.gtag) { gtag('event', 'pwa_installed', { event_category: 'PWA', event_label: 'app_installed' }); } }); }, // ì•± ì„¤ì¹˜ ì‹¤í–‰ async installApp() { if (!this.deferredPrompt) { this.showInfoNotification('ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ "í™ˆ í™”ë©´ì— ì¶”ê°€"ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } try { this.deferredPrompt.prompt(); const { outcome } = await this.deferredPrompt.userChoice; if (outcome === 'accepted') { console.log('[PWA] ì‚¬ìš©ìžê°€ ì„¤ì¹˜ë¥¼ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤.'); } else { console.log('[PWA] ì‚¬ìš©ìžê°€ ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.'); } this.deferredPrompt = null; this.isInstallable = false; if (window.gtag) { gtag('event', 'pwa_install_prompt', { event_category: 'PWA', event_label: outcome }); } } catch (error) { console.error('[PWA] ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜:', error); this.showErrorNotification('ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); } }, // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ showInstallButton() { let installBtn = document.getElementById('pwa-install-btn'); if (!installBtn) { installBtn = document.createElement('button'); installBtn.id = 'pwa-install-btn'; installBtn.className = 'pwa-install-btn'; installBtn.innerHTML = ' ì•± ì„¤ì¹˜'; installBtn.onclick = () => this.installApp(); // í—¤ë” ì»¨íŠ¸ë¡¤ì— ì¶”ê°€ const headerControls = document.querySelector('.header-controls'); if (headerControls) { headerControls.appendChild(installBtn); } } installBtn.style.display = 'flex'; }, // ì„¤ì¹˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸° hideInstallButton() { const installBtn = document.getElementById('pwa-install-btn'); if (installBtn) { installBtn.style.display = 'none'; } }, // ì—…ë°ì´íŠ¸ ì•Œë¦¼ showUpdateNotification() { const message = `
ìƒˆë¡œìš´ ë²„ì „ì´ ìžˆìŠµë‹ˆë‹¤!
ì—…ë°ì´íŠ¸
`; this.showNotification(message, 'info', 10000); }, // ì•Œë¦¼ ì‹œìŠ¤í…œ showNotification(message, type = 'info', duration = 5000) { const notification = document.createElement('div'); notification.className = `error-notification ${type}`; const iconMap = { error: 'fas fa-exclamation-circle', success: 'fas fa-check-circle', warning: 'fas fa-exclamation-triangle', info: 'fas fa-info-circle' }; notification.innerHTML = `
${message}

`; let container = document.querySelector('.error-container'); if (!container) { container = document.createElement('div'); container.className = 'error-container'; document.body.appendChild(container); } container.appendChild(notification); // ì• ë‹ˆë©”ì´ì…˜ setTimeout(() => notification.classList.add('show'), 100); // ìžë™ ì œê±° if (duration > 0) { setTimeout(() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 300); }, duration); } }, showErrorNotification(message) { this.showNotification(message, 'error'); }, showSuccessNotification(message) { this.showNotification(message, 'success'); }, showWarningNotification(message) { this.showNotification(message, 'warning'); }, showInfoNotification(message) { this.showNotification(message, 'info'); }, // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ monitorNetworkStatus() { const updateNetworkStatus = () => { const isOnline = navigator.onLine; let statusElement = document.querySelector('.network-status'); if (!statusElement) { statusElement = document.createElement('div'); statusElement.className = 'network-status'; document.body.appendChild(statusElement); } if (isOnline) { statusElement.textContent = 'ì˜¨ë¼ì¸ ìƒíƒœ'; statusElement.classList.add('online'); statusElement.classList.add('show'); setTimeout(() => { statusElement.classList.remove('show'); }, 2000); } else { statusElement.textContent = 'ì˜¤í”„ë¼ì¸ ìƒíƒœ - ìºì‹œëœ ì½˜í…ì¸  ì‚¬ìš© ì¤‘'; statusElement.classList.remove('online'); statusElement.classList.add('show'); } if (window.gtag) { gtag('event', 'network_status', { event_category: 'PWA', event_label: isOnline ? 'online' : 'offline' }); } }; window.addEventListener('online', updateNetworkStatus); window.addEventListener('offline', updateNetworkStatus); // ì´ˆê¸° ìƒíƒœ í™•ì¸ updateNetworkStatus(); }, // PWA ê¸°ëŠ¥ ì´ˆê¸°í™” async init() { console.log('[PWA] PWA ë§¤ë‹ˆì € ì´ˆê¸°í™” ì¤‘...'); // Service Worker ë“±ë¡ await this.registerServiceWorker(); // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬ this.handleInstallPrompt(); // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§ this.monitorNetworkStatus(); // ì´ë¯¸ ì„¤ì¹˜ëœ ìƒíƒœì¸ì§€ í™•ì¸ if (window.matchMedia('(display-mode: standalone)').matches) { this.isInstalled = true; console.log('[PWA] ì•±ì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ì‹¤í–‰ ì¤‘ìž…ë‹ˆë‹¤.'); } console.log('[PWA] PWA ë§¤ë‹ˆì € ì´ˆê¸°í™” ì™„ë£Œ'); } }; // PWA ì´ˆê¸°í™” (DOM ë¡œë“œ í›„) document.addEventListener('DOMContentLoaded', () => { PWAManager.init(); });