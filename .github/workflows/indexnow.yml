name: IndexNow Auto Ping

on:
  push:
    branches:
      - main
    paths:
      - '**.html'

jobs:
  indexnow:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Send IndexNow Pings
        shell: bash
        run: |
          CHANGED=0
          while IFS= read -r -d '' file; do
            case "$file" in
              *.html)
                URL="https://tests.mahalohana-bruce.com/${file}"
                echo "ðŸ”— Pinging: $URL"
                curl -s "https://www.bing.com/indexnow?url=${URL}&key=5cbdaab6677a4f3db093ec20be02affb" >/dev/null || true
                CHANGED=1
                ;;
            esac
          done < <(git diff --name-only -z "${{ github.event.before }}" "${{ github.sha }}")

          if [ "$CHANGED" -eq 0 ]; then
            echo "ðŸ”¸ ë³€ê²½ëœ HTML íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. IndexNow Ping ìƒëžµí•©ë‹ˆë‹¤."
          fi
